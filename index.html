<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Dymaxion Map</title>
  <style>
    body {
      font-family: sans-serif;
    }
    #eqrContainer {
      position: relative;
    }
    #eqrOverlayContainer {
      position: absolute;
      top: 0px;
      left: 0px;
    }
    #eqrImageContainer canvas {
      border: solid 1px #000;
    }
    #eqrOverlayContainer canvas {
      border: solid 1px #000;
    }
    #dymContainer canvas {
      border: solid 1px #000;
    }
  </style>
  <script
    src="https://code.jquery.com/jquery-3.4.1.min.js"
    integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo="
    crossorigin="anonymous"></script>
</head>

<body>

  <div id="eqrContainer">
    <div id="eqrImageContainer"></div>
    <div id="eqrOverlayContainer"></div>
  </div>
  <div id="dymContainer"></div>

  <script src="utils.js"></script>
  <script src="drawing.js"></script>
  <script src="icosahedron.js"></script>
  <script src="subfaces.js"></script>
  <script src="equirectangular.js"></script>
  <script src="dymaxion.js"></script>
  <script>

    function main() {

      var eqrImageSrc = 'eqr_world_1.png';
      var dymDivisionCount = 6;
      // var angles = [-2, 0.4, 0.4]  // [zAngle, yAngle, xAngle]
      var angles = [-2, 0.5, 0.5]  // [zAngle, yAngle, xAngle]

      var eqrImageDrawing = new Drawing({
        parentEl: $('#eqrImageContainer'),
        width: 1024,
        height: 512,
        p0: [0, 0],
        scale: 2 * 1024 / (2 * Math.PI)
      });

      var eqrOverlayDrawing = new Drawing({
        parentEl: $('#eqrOverlayContainer'),
        width: 1024,
        height: 512,
        p0: [0, 0],
        scale: 2 * 1024 / (2 * Math.PI)
      });

      var dymDrawing = new Drawing({
        parentEl: $('#dymContainer'),
        width: 1024,
        height: 512,
        p0: [-0.18, -0.4],
        scale: 350
      });

      var subfaceData = Subfaces.createSubfaceData({
        divisionCount: dymDivisionCount
      });

      // Load the equirectangular map image
      loadImage(eqrImageSrc, function(eqrImageEl) {
        
        Equirectangular.drawMapImage({
          drawing: eqrImageDrawing,
          imageEl: eqrImageEl
        });

        var vertices = Icosahedron.getVerticesRotated(angles);

        Equirectangular.drawOverlayMap({
          drawing: eqrOverlayDrawing,
          vertices: vertices
        });

        Dymaxion.drawMap({
          drawing: dymDrawing,
          subfaceData: subfaceData,
          divisionCount: dymDivisionCount,
          vertices: vertices,
          eqrImageDrawing: eqrImageDrawing
        });

      });

    }

    $(document).ready(function() {
      main();
    });

  </script>
</body>

</html>
